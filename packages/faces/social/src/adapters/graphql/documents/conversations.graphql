# Conversation queries and mutations

#import "./fragments.graphql"

query Conversations($folder: ConversationFolder = INBOX, $first: Int = 20, $after: Cursor) {
	conversations(folder: $folder, first: $first, after: $after) {
		id
		unread
		createdAt
		updatedAt
		viewerMetadata {
			requestState
			requestedAt
			acceptedAt
			declinedAt
		}
		accounts {
			...ActorSummary
		}
		lastStatus {
			...ObjectFields
		}
	}
}

query Conversation($id: ID!) {
	conversation(id: $id) {
		id
		unread
		createdAt
		updatedAt
		viewerMetadata {
			requestState
			requestedAt
			acceptedAt
			declinedAt
		}
		accounts {
			...ActorSummary
		}
		lastStatus {
			...ObjectFields
		}
	}
}

query ConversationMessages($conversationId: ID!, $first: Int = 50, $after: Cursor) {
	conversationMessages(conversationId: $conversationId, first: $first, after: $after) {
		edges {
			cursor
			node {
				...ObjectFields
			}
		}
		pageInfo {
			hasNextPage
			endCursor
		}
		totalCount
	}
}

mutation CreateConversation($participantId: ID!) {
	createConversation(participantId: $participantId) {
		id
		unread
		createdAt
		updatedAt
		viewerMetadata {
			requestState
			requestedAt
			acceptedAt
			declinedAt
		}
		accounts {
			...ActorSummary
		}
		lastStatus {
			...ObjectFields
		}
	}
}

mutation SendMessage($conversationId: ID!, $content: String!, $mediaIds: [ID!]) {
	sendMessage(conversationId: $conversationId, content: $content, mediaIds: $mediaIds) {
		conversation {
			id
			unread
			createdAt
			updatedAt
			viewerMetadata {
				requestState
				requestedAt
				acceptedAt
				declinedAt
			}
			accounts {
				...ActorSummary
			}
			lastStatus {
				...ObjectFields
			}
		}
		message {
			...ObjectFields
		}
	}
}

mutation AcceptMessageRequest($conversationId: ID!) {
	acceptMessageRequest(conversationId: $conversationId) {
		id
		unread
		createdAt
		updatedAt
		viewerMetadata {
			requestState
			requestedAt
			acceptedAt
			declinedAt
		}
		accounts {
			...ActorSummary
		}
		lastStatus {
			...ObjectFields
		}
	}
}

mutation DeclineMessageRequest($conversationId: ID!) {
	declineMessageRequest(conversationId: $conversationId)
}

mutation MarkConversationRead($id: ID!) {
	markConversationAsRead(id: $id) {
		id
		unread
		updatedAt
	}
}

mutation DeleteConversation($id: ID!) {
	deleteConversation(id: $id)
}
