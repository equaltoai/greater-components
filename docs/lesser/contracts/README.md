# API Contracts (File-Only)

<!-- AI Training: How Lesser publishes contracts for client teams -->

This directory contains **generated, file-only API contracts** that client teams consume at build time.

These files are:

- not served from deployed instances (they live in-repo),
- generated from code/schema sources of truth, and
- verified in `./lesser verify` to prevent drift.

## Why contracts live here (not “in the server”)

**Business value:** client teams need stable, reviewable artifacts they can diff and generate against without scraping a
running environment.

✅ CORRECT: treat `docs/contracts/*` as the published “client contract”.

❌ INCORRECT: copy/paste ad-hoc response examples from production logs into client code.

## REST (OpenAPI)

- Published contract: `docs/contracts/openapi.yaml`
- Source of truth: route code + handlers (generated by `./tools/openapi`)
- Generate: `./lesser generate openapi`
- Verify: `./lesser verify openapi --strict`

Client generation guidance:

- `docs/specs/openapi-client-generation.md`

## GraphQL (Published schema)

- Published contract: `docs/contracts/graphql-schema.graphql`
- Source of truth: `graph/*.graphql` (aggregated for client teams)
- Generate: `./lesser schema`
- Verify: `./lesser verify schema`

## Common workflow (contract change)

1) Update the source of truth (routes/handlers or `graph/*.graphql`)
2) Regenerate contracts:

```bash
./lesser generate openapi
./lesser schema
```

3) Verify:

```bash
./lesser verify
```
