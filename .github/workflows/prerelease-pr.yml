name: Prerelease PR (premain)

on:
  push:
    branches: ['premain']
    paths-ignore:
      - '.release-please-manifest.premain.json'
      - 'CHANGELOG.md'
      - 'package.json'
      - 'registry/index.json'
      - 'registry/latest.json'
      - 'packages/**/package.json'
      - 'packages/**/manifest.json'
  workflow_dispatch: {}

permissions:
  contents: write
  issues: write
  pull-requests: write

jobs:
  release-please:
    runs-on: ubuntu-latest
    steps:
      - name: Release Please (PR only, signed-off)
        env:
          RELEASE_PLEASE_TOKEN: ${{ secrets.RELEASE_PLEASE_TOKEN || secrets.GITHUB_TOKEN }}
        run: |
          set -euo pipefail

          npx -y release-please@17.1.3 release-pr \
            --token "${RELEASE_PLEASE_TOKEN}" \
            --repo-url "${GITHUB_REPOSITORY}" \
            --target-branch premain \
            --config-file release-please-config.premain.json \
            --manifest-file .release-please-manifest.premain.json \
            --signoff "github-actions[bot] <github-actions[bot]@users.noreply.github.com>"
